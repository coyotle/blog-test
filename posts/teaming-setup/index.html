<!doctype html><html lang=ru dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Настройка Teaming | Мини-блог об IT, Linux, Open Source, Tech</title><meta name=keywords content="linux,network"><meta name=description content="Коротенько опишу как настроить Network Teaming или Team в Linux. Технология служит для агрегации портов с целью увеличения пропускной способности и обеспечения отказоустойчивости сети.
sudo apt install libteam-utils
teamnl team0 getoption mode
*NOMODE*
Типы режимов
Есть пять режимов работы, в основном используются первые три:

activebackup
roundrobin
loadbalance
broadcast
lacp

activebackup
Один порт находится в активном состоянии, остальные в запасе. При пропадании линка на активном порту активный порт меняется на другой доступный."><meta name=author content><link rel=canonical href=https://coyotle.ru/posts/teaming-setup/><link crossorigin=anonymous href=/assets/css/stylesheet.d6626ca70f3a7dda16dfce9eb29df152c81185d6739a741054093fb92b9e6839.css integrity="sha256-1mJspw86fdoW386esp3xUsgRhdZzmnQQVAk/uSueaDk=" rel="preload stylesheet" as=style><link rel=icon href=https://coyotle.ru/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://coyotle.ru/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://coyotle.ru/favicon-32x32.png><link rel=apple-touch-icon href=https://coyotle.ru/apple-touch-icon.png><link rel=mask-icon href=https://coyotle.ru/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=ru href=https://coyotle.ru/posts/teaming-setup/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://coyotle.ru/posts/teaming-setup/"><meta property="og:site_name" content="Мини-блог об IT, Linux, Open Source, Tech"><meta property="og:title" content="Настройка Teaming"><meta property="og:description" content="Коротенько опишу как настроить Network Teaming или Team в Linux. Технология служит для агрегации портов с целью увеличения пропускной способности и обеспечения отказоустойчивости сети.
sudo apt install libteam-utils teamnl team0 getoption mode *NOMODE* Типы режимов Есть пять режимов работы, в основном используются первые три:
activebackup roundrobin loadbalance broadcast lacp activebackup Один порт находится в активном состоянии, остальные в запасе. При пропадании линка на активном порту активный порт меняется на другой доступный."><meta property="og:locale" content="ru-RU"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-28T23:39:12+03:00"><meta property="article:modified_time" content="2022-09-28T23:39:12+03:00"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Network"><meta name=twitter:card content="summary"><meta name=twitter:title content="Настройка Teaming"><meta name=twitter:description content="Коротенько опишу как настроить Network Teaming или Team в Linux. Технология служит для агрегации портов с целью увеличения пропускной способности и обеспечения отказоустойчивости сети.
sudo apt install libteam-utils
teamnl team0 getoption mode
*NOMODE*
Типы режимов
Есть пять режимов работы, в основном используются первые три:

activebackup
roundrobin
loadbalance
broadcast
lacp

activebackup
Один порт находится в активном состоянии, остальные в запасе. При пропадании линка на активном порту активный порт меняется на другой доступный."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Посты","item":"https://coyotle.ru/posts/"},{"@type":"ListItem","position":2,"name":"Настройка Teaming","item":"https://coyotle.ru/posts/teaming-setup/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Настройка Teaming","name":"Настройка Teaming","description":"Коротенько опишу как настроить Network Teaming или Team в Linux. Технология служит для агрегации портов с целью увеличения пропускной способности и обеспечения отказоустойчивости сети.\nsudo apt install libteam-utils teamnl team0 getoption mode *NOMODE* Типы режимов Есть пять режимов работы, в основном используются первые три:\nactivebackup roundrobin loadbalance broadcast lacp activebackup Один порт находится в активном состоянии, остальные в запасе. При пропадании линка на активном порту активный порт меняется на другой доступный.\n","keywords":["linux","network"],"articleBody":"Коротенько опишу как настроить Network Teaming или Team в Linux. Технология служит для агрегации портов с целью увеличения пропускной способности и обеспечения отказоустойчивости сети.\nsudo apt install libteam-utils teamnl team0 getoption mode *NOMODE* Типы режимов Есть пять режимов работы, в основном используются первые три:\nactivebackup roundrobin loadbalance broadcast lacp activebackup Один порт находится в активном состоянии, остальные в запасе. При пропадании линка на активном порту активный порт меняется на другой доступный.\nroundrobin В случае с Round robin все интерфейсы находятся в активном состоянии, запросы отправляются поочередно через все активные порты. Если линк на порту пропадает - запросы начинают идти через оставшиеся.\nloadbalance Все порты активны одновременно. Система пытается загружать их равномерно. С точки зрения принятых практик в индустрии мы используем activebackup и roundrobin. Балансировщики нагрузки реализуются на уровне приложений.\nbroadcast Пакеты отправляются со всех портов\nlacp Реализует 802.3ad Link Aggregation Control Protocol. Может использовать те же возможности выбора порта передачи, что и loadbalance.\nНастройка activebackup /etc/teamd.d/team0.conf\n{ \"device\": \"team0\", \"ports\": { \"eth0\": { \"link_watch\": { \"name\": \"ethtool\" } }, \"eth1\": { \"link_watch\": { \"name\": \"ethtool\" } } }, \"runner\": { \"name\": \"activebackup\", \"hwaddr_policy\": \"by_active\" } } sudo teamd -U -D -o -t team0 -f /etc/teamd.d/team0.conf Настройка systemd /etc/systemd/system/teamd@.service\n[Unit] Description=Team Daemon for device %I Before=network-pre.target Wants=network-pre.target [Service] BusName=org.libteam.teamd.%i ExecStart=/usr/bin/teamd -U -D -o -t %i -f /run/teamd/%i.conf Restart=on-failure RestartPreventExitStatus=1 systemctl enable teamd@team0 В ручном режиме sudo ip link add type team team0 sudo teamnl team0 setoption mode activebackup sudo ip link set dev eth0 master team0 sudo ip link set dev eth1 master team0 ","wordCount":"253","inLanguage":"ru","datePublished":"2022-09-28T23:39:12+03:00","dateModified":"2022-09-28T23:39:12+03:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://coyotle.ru/posts/teaming-setup/"},"publisher":{"@type":"Organization","name":"Мини-блог об IT, Linux, Open Source, Tech","logo":{"@type":"ImageObject","url":"https://coyotle.ru/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://coyotle.ru/ accesskey=h title="Мини-блог об IT, Linux, Open Source, Tech (Alt + H)">Мини-блог об IT, Linux, Open Source, Tech</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://coyotle.ru/tags/ title=тэги><span>тэги</span></a></li><li><a href=https://coyotle.ru/about/ title="обо мне"><span>обо мне</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Настройка Teaming</h1><div class=post-meta><span title='2022-09-28 23:39:12 +0300 +0300'>28 сентября 2022</span></div></header><div class=post-content><p>Коротенько опишу как настроить Network Teaming или Team в Linux. Технология служит для агрегации портов с целью увеличения пропускной способности и обеспечения отказоустойчивости сети.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo apt install libteam-utils
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>teamnl team0 getoption mode
</span></span><span class=line><span class=cl>*NOMODE*
</span></span></code></pre></div><h2 id=типы-режимов>Типы режимов<a hidden class=anchor aria-hidden=true href=#типы-режимов>#</a></h2><p>Есть пять режимов работы, в основном используются первые три:</p><ul><li><strong>activebackup</strong></li><li><strong>roundrobin</strong></li><li><strong>loadbalance</strong></li><li>broadcast</li><li>lacp</li></ul><h3 id=activebackup>activebackup<a hidden class=anchor aria-hidden=true href=#activebackup>#</a></h3><p>Один порт находится в активном состоянии, остальные в запасе. При пропадании линка на активном порту активный порт меняется на другой доступный.</p><h3 id=roundrobin>roundrobin<a hidden class=anchor aria-hidden=true href=#roundrobin>#</a></h3><p>В случае с Round robin все интерфейсы находятся в активном состоянии, запросы отправляются поочередно через все активные порты. Если линк на порту пропадает - запросы начинают идти через оставшиеся.</p><h3 id=loadbalance>loadbalance<a hidden class=anchor aria-hidden=true href=#loadbalance>#</a></h3><p>Все порты активны одновременно. Система пытается загружать их равномерно. С точки зрения принятых практик в индустрии мы используем activebackup и roundrobin. Балансировщики нагрузки реализуются на уровне приложений.</p><h3 id=broadcast>broadcast<a hidden class=anchor aria-hidden=true href=#broadcast>#</a></h3><p>Пакеты отправляются со всех портов</p><h3 id=lacp>lacp<a hidden class=anchor aria-hidden=true href=#lacp>#</a></h3><p>Реализует 802.3ad Link Aggregation Control Protocol. Может использовать те же возможности выбора порта передачи, что и loadbalance.</p><h2 id=настройка-activebackup>Настройка activebackup<a hidden class=anchor aria-hidden=true href=#настройка-activebackup>#</a></h2><p>/etc/teamd.d/team0.conf</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;device&#34;</span><span class=p>:</span> <span class=s2>&#34;team0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ports&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;eth0&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;link_watch&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;ethtool&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;eth1&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;link_watch&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;ethtool&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;runner&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;activebackup&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;hwaddr_policy&#34;</span><span class=p>:</span> <span class=s2>&#34;by_active&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo teamd -U -D -o -t team0 -f /etc/teamd.d/team0.conf
</span></span></code></pre></div><h2 id=настройка-systemd>Настройка systemd<a hidden class=anchor aria-hidden=true href=#настройка-systemd>#</a></h2><p>/etc/systemd/system/teamd@.service</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Team Daemon for device %I</span>
</span></span><span class=line><span class=cl><span class=na>Before</span><span class=o>=</span><span class=s>network-pre.target</span>
</span></span><span class=line><span class=cl><span class=na>Wants</span><span class=o>=</span><span class=s>network-pre.target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>BusName</span><span class=o>=</span><span class=s>org.libteam.teamd.%i</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/usr/bin/teamd -U -D -o -t %i -f /run/teamd/%i.conf</span>
</span></span><span class=line><span class=cl><span class=na>Restart</span><span class=o>=</span><span class=s>on-failure</span>
</span></span><span class=line><span class=cl><span class=na>RestartPreventExitStatus</span><span class=o>=</span><span class=s>1</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>systemctl enable teamd@team0
</span></span></span></code></pre></div><h2 id=в-ручном-режиме>В ручном режиме<a hidden class=anchor aria-hidden=true href=#в-ручном-режиме>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo ip link add <span class=nb>type</span> team team0
</span></span><span class=line><span class=cl>sudo teamnl team0 setoption mode activebackup
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo ip link <span class=nb>set</span> dev eth0 master team0
</span></span><span class=line><span class=cl>sudo ip link <span class=nb>set</span> dev eth1 master team0
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://coyotle.ru/tags/linux/>Linux</a></li><li><a href=https://coyotle.ru/tags/network/>Network</a></li></ul><nav class=paginav><a class=prev href=https://coyotle.ru/posts/stable-diffusion/><span class=title>« Предыдущая</span><br><span>Искусство и Stable Diffusion</span>
</a><a class=next href=https://coyotle.ru/posts/vxlan-setup/><span class=title>Следующая »</span><br><span>Настройка VXLAN</span></a></nav></footer><div class=comments></div><script>function setComments(e){let t=document.createElement("script");t.src="https://utteranc.es/client.js",t.setAttribute("id","comments-script"),t.setAttribute("repo","coyotle/blog"),t.setAttribute("issue-term","pathname"),t.setAttribute("theme",e),t.setAttribute("label","comment"),t.setAttribute("crossorigin","anonymous"),t.setAttribute("async",""),document.querySelector("div.comments").innerHTML="",document.querySelector("div.comments").appendChild(t)}document.getElementById("theme-toggle").addEventListener("click",()=>{setComments(document.body.className.includes("dark")?"github-light":"github-dark")});let theme=document.body.className.includes("dark")?"github-dark":"github-light";setComments(theme)</script></article></main><footer class=footer><span>&copy; 2025 <a href=https://coyotle.ru/>Мини-блог об IT, Linux, Open Source, Tech</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="копировать";function s(){t.innerHTML="скопировано!",setTimeout(()=>{t.innerHTML="копировать"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>